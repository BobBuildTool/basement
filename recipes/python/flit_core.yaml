inherit: ["basement::bits::python3-pkg"]

metaEnvironment:
    PKG_VERSION: "3.12.0"
    PKG_LICENSE: "BSD-3-Clause"

checkoutSCM:
    scm: url
    url: https://files.pythonhosted.org/packages/source/f/flit/flit-${PKG_VERSION}.tar.gz
    digestSHA256: 1c80f34dd96992e7758b40423d2809f48f640ca285d0b7821825e50745ec3740
    stripComponents: 1

buildScript: |
   rm -rf install && mkdir -p install
   rsync -a --delete $1/ .
   pushd flit_core
   python3 build_dists.py

   PURELIB=$(python3 -c "import sysconfig; import os;\
      print(os.path.relpath(sysconfig.get_path('purelib'),sysconfig.get_path('data')))")

   python3 bootstrap_install.py dist/flit_core*.whl \
     -i $(pwd)/../install/usr/${PURELIB}

packageScript: |
   rsync -a --delete $1/install/ .
