inherit: [make, install]

metaEnvironment:
    PKG_VERSION: "2.8.0"

depends:
    - libs::zlib-dev
    - libs::openssl-dev
    - net::curl-dev

    - use: []
      depends:
        - libs::zlib-tgt
        - libs::openssl-tgt
        - net::curl-tgt

checkoutSCM:
    scm: url
    url: https://www.kernel.org/pub/software/scm/git/git-${PKG_VERSION}.tar.gz
    digestSHA1: "14fcb455094c77e3b7c399a21fedf3e869bd18e2"
    extract: False

buildTools: [target-toolchain]
buildVars: [PKG_VERSION, AUTOCONF_HOST,
    CPPFLAGS, CFLAGS, LDFLAGS]
buildScript: |
    export CFLAGS="-I${BOB_DEP_PATHS[libs::zlib-dev]}/usr/include -I${BOB_DEP_PATHS[libs::openssl-dev]}/usr/include"
    export LDFLAGS="-L${BOB_DEP_PATHS[libs::zlib-dev]}/usr/lib -L${BOB_DEP_PATHS[libs::openssl-dev]}/usr/lib -Wl,-rpath-link=${BOB_DEP_PATHS[libs::zlib-dev]}/usr/lib -Wl,-rpath-link=${BOB_DEP_PATHS[libs::openssl-dev]}/usr/lib"

    mkdir -p install
    tar -xzf $1/git-${PKG_VERSION}.tar.gz

    pushd git-${PKG_VERSION}
    ./configure --host=${AUTOCONF_HOST} \
                --prefix=/usr \
                --with-curl=${BOB_DEP_PATHS[net::curl-dev]}/usr \
                --without-python \
                --without-expat
    makeParallel
    make DESTDIR=${PWD}/../install install
    popd

packageScript: |
    installPackageTgt "$1/install/"

provideDeps: [ "*-tgt" ]
