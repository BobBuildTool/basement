inherit: [cpackage, install, patch]

metaEnvironment:
    PKG_VERSION: "1.13.1"
    PKG_LICENSE: "Apache-2.0"

checkoutSCM:
    scm: url
    url: ${GITHUB_MIRROR}/ninja-build/ninja/archive/v1.13.1.tar.gz
    digestSHA256: f0055ad0369bf2e372955ba55128d000cfcc21777057806015b45e4accbebf23
    stripComponents: 1

buildVars: [AR, CC, CXX, CFLAGS, CXXFLAGS, LDFLAGS]
buildToolsWeak: [python3]
multiPackage:
    "":
        depends:
            - name: devel::ninja-bootstrap
              use: [tools]
              tools:
                  target-toolchain: host-compat-toolchain

        buildToolsWeak: [ninja]
        buildScript: |
            python3 "$1/configure.py"
            ninja
            mkdir -p install/usr/bin
            cp ninja install/usr/bin/

    bootstrap:
        buildScript: |
            python3 "$1/configure.py" --bootstrap
            mkdir -p install/usr/bin
            cp ninja install/usr/bin/

packageScript: |
    installPackageTgt "$1/install/"

provideTools:
    ninja: usr/bin
