inherit: [autotools]

metaEnvironment:
    PKG_VERSION_MAJOR: "2.41"
    PKG_VERSION: "2.41.3"
    PKG_LICENSE: "LicenseRef-util-linux"
    PKG_LICENSE_PATH:
        util-linux:README.licensing

Config:
    UTIL_LINUX_SU:
        type: bool
        default: False

depends:
    - libs::ncurses-dev
    - libs::zlib-dev

    - use: []
      depends:
          - libs::ncurses-tgt
          - libs::zlib-tgt

    - if: "$UTIL_LINUX_SU"
      depends:
          - core::linux-pam-dev
          - use: []
            name: core::linux-pam-tgt

checkoutSCM:
    scm: url
    url: ${KERNEL_MIRROR}/linux/utils/util-linux/v${PKG_VERSION_MAJOR}/util-linux-${PKG_VERSION}.tar.xz
    digestSHA256: "3330d873f0fceb5560b89a7dc14e4f3288bbd880e96903ed9b50ec2b5799e58b"
    stripComponents: 1

buildScript: |
    export PATH="${BOB_DEP_PATHS[libs::ncurses-dev]}/usr/bin:$PATH"
    autotoolsBuild $1 \
        --without-python \
        --disable-makeinstall-chown \
        --without-systemdsystemunitdir \
        --enable-usrdir-path \
        --disable-widechar \
        --without-ncursesw \
        --with-ncurses \
        --disable-liblastlog2 \
        bindir=/usr/bin \
        sbindir=/usr/sbin

multiPackage:
    "":
        depends:
            - name: core::util-linux-tgt
              use: []
        packageScript: autotoolsPackageBin
        provideDeps: [ "*-tgt" ]
        provideTools:
            util-linux: "usr/sbin"

    dev:
        packageScript: autotoolsPackageDev
        provideDeps: [ "*-dev" ]

    tgt:
        packageScript: autotoolsPackageLib
        provideDeps: [ "*-tgt" ]
