inherit: [make, cpackage, install]

metaEnvironment:
    PKG_LICENSE: "0BSD"
    PKG_VERSION: "1.4.6"

checkoutSCM:
    scm: url
    url: ${SOURCEFORGE_MIRROR}/rhash/rhash-${PKG_VERSION}-src.tar.gz
    digestSHA256: 9f6019cfeeae8ace7067ad22da4e4f857bb2cfa6c2deaa2258f55b2227ec937a
    stripComponents: 1

buildTools: [target-toolchain]
buildVars: [AR, CC]
buildScript: |
    case "$(cpackageLibraryType)" in
        static)
            BUILD_TARGETS=( lib-static )
            INSTALL_TARGETS=( install-lib-static install-lib-headers )
            ;;
        shared)
            BUILD_TARGETS=( lib-shared )
            INSTALL_TARGETS=( install-lib-shared install-so-link install-lib-headers )
            ;;
        both)
            BUILD_TARGETS=( lib-static lib-shared )
            INSTALL_TARGETS=( install-lib-static install-lib-shared install-so-link install-lib-headers )
            ;;
    esac

    mkdir -p build install
    pushd build
    rsync -aH "$1/" .
    ./configure \
        ${AUTOCONF_TARGET:+--target=${AUTOCONF_TARGET}} \
        --prefix="/usr" \
        --sysconfdir="/etc"

    make AR=${AR} PREFIX="/usr" "${BUILD_TARGETS[@]}"
    make -C librhash PREFIX="/usr" DESTDIR="$PWD/../install" "${INSTALL_TARGETS[@]}"
    popd

multiPackage:
    dev:
        packageScript: installPackageDev "$1/install/"
    tgt:
        packageScript: installPackageTgt "$1/install/"
