inherit: [meson, 'python3::build']

metaEnvironment:
    PKG_LICENSE: "LGPL-2.1-or-later"
    PKG_VERSION: "2.87.2"

depends:
    - libs::libffi-dev
    - libs::libpcre2-dev
    - libs::zlib-dev

    - use: []
      depends:
          - libs::libffi-tgt
          - libs::libpcre2-tgt
          - libs::zlib-tgt

checkoutSCM:
    scm: url
    url: http://ftp.gnome.org/pub/gnome/sources/glib/2.87/glib-${PKG_VERSION}.tar.xz
    digestSHA256: "d6eb74a4f4ffc0b56df79ae3a939463b1d92c623f6c167d51aab24e303a851f3"
    stripComponents: 1

buildScript: |
    mesonBuild $1 -Dtests=false
    pushd install/usr/lib/pkgconfig
    sed -i 's/\${bindir}\///g' glib-2.0.pc gio-2.0.pc
    popd

multiPackage:
    dev:
        packageScript: |
            # make sure glibconfig.h is copied too
            mesonPackageDev "$1" "/usr/lib/glib-2.0/***" \
                           "/usr/share/" \
                           "/usr/share/aclocal/***" \
                           "/usr/bin/***"
        provideDeps: [ "*-dev" ]
    tgt:
        packageScript: mesonPackageLib
        provideDeps: [ "*-tgt" ]
    tools:
        packageScript: mesonPackageBin
        provideTools:
            glib: usr/bin
