inherit: [make, strip]

metaEnvironment:
    PKG_VERSION: "4.5.0.20241231"
    PKG_LICENSE: "LicenseRef-newlib"
    PKG_LICENSE_PATH: |
        newlib:COPYING.NEWLIB

checkoutSCM:
    scm: url
    url: ${SOURCEWARE_MIRROR}/newlib/newlib-${PKG_VERSION}.tar.gz
    digestSHA1: "2f170b41e2a6cd456ef01445168dd7268ef87b20"
    stripComponents: 1

checkoutDeterministic: True
checkoutScript: |
    # Work around Makefile bug creating files in the source
    touch libgloss/doc/porting.info

buildTools: [host-toolchain, target-toolchain]
buildVars: [AUTOCONF_HOST]
buildScript: |
    rm -rf install
    mkdir -p build install
    pushd build
    $1/configure \
        --prefix=/usr \
        --target=${AUTOCONF_HOST} \
        --libdir=/usr/lib \
        --disable-newlib-supplied-syscalls \
        --enable-lite-exit \
        --enable-target-optspace
    makeParallel
    makeSequential install DESTDIR=${PWD}/../install
    popd
    pushd install
    mv usr/$AUTOCONF_HOST/* usr/
    rmdir usr/$AUTOCONF_HOST
    popd

packageScript: |
    cp -a $1/install/* .
    stripAll .
